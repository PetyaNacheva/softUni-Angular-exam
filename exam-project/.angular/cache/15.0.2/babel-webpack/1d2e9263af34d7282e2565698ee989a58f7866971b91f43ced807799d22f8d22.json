{"ast":null,"code":"import { BehaviorSubject, combineLatest, mergeMap } from 'rxjs';\nimport { MessageType } from 'src/app/core/message-bus.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/core/movie.service\";\nimport * as i3 from \"src/app/auth.service\";\nimport * as i4 from \"src/app/core/message-bus.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../movies-new-page/movies-new-page.component\";\nimport * as i7 from \"../movies-new-comment/movies-new-comment.component\";\nfunction MoviesDetailPageComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"app-movies-new-page\", 1);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"makeUpdate\", ctx_r0.makeUpdate)(\"movieToUpdate\", ctx_r0.movie);\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_div_1_ul_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 16)(1, \"li\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const actor_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(actor_r6);\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_1_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r10.updateMovie());\n    });\n    i0.ɵɵtext(2, \"Edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_1_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r12 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r12.deleteMovieHandler());\n    });\n    i0.ɵɵtext(4, \"Delete\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_2_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r13.likeMovie());\n    });\n    i0.ɵɵtext(2, \"Like\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_2_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r15.dislikeMovie());\n    });\n    i0.ɵɵtext(4, \"Dislike\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r8.canLike);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", !ctx_r8.canLike);\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵtext(1, \" You already liked it! But you can dislike it. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_1_Template, 5, 0, \"div\", 0);\n    i0.ɵɵtemplate(2, MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_2_Template, 5, 2, \"div\", 0);\n    i0.ɵɵtemplate(3, MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_div_3_Template, 2, 0, \"div\", 17);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r4.isUserAuthor);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r4.isUserAuthor);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r4.canLike);\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_div_1_app_movies_new_comment_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-movies-new-comment\", 23);\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"movieId\", ctx_r5.movie._id)(\"movie\", ctx_r5.movie);\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 4)(2, \"h1\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 5);\n    i0.ɵɵelement(5, \"i\", 6);\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"br\")(9, \"img\", 7);\n    i0.ɵɵelementStart(10, \"p\", 8);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"h2\", 9);\n    i0.ɵɵelement(13, \"i\", 10);\n    i0.ɵɵtext(14, \" Actors: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(15, MoviesDetailPageComponent_ng_container_1_div_1_ul_15_Template, 3, 1, \"ul\", 11);\n    i0.ɵɵelementStart(16, \"div\", 12)(17, \"div\", 13)(18, \"i\", 14);\n    i0.ɵɵtext(19, \"Likes: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(21, MoviesDetailPageComponent_ng_container_1_div_1_ng_container_21_Template, 4, 3, \"ng-container\", 0);\n    i0.ɵɵpipe(22, \"async\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(23, MoviesDetailPageComponent_ng_container_1_div_1_app_movies_new_comment_23_Template, 1, 2, \"app-movies-new-comment\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.movie.title);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" date: \", i0.ɵɵpipeBind2(7, 8, ctx_r2.movie.created_at, \"medium\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"src\", ctx_r2.movie.poster, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.movie.shortStory);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.movie.actors);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.movie.likes.length, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(22, 11, ctx_r2.isLoggedIn$));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.isUserAuthor);\n  }\n}\nfunction MoviesDetailPageComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, MoviesDetailPageComponent_ng_container_1_div_1_Template, 24, 13, \"div\", 2);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.movie);\n  }\n}\nexport class MoviesDetailPageComponent {\n  constructor(activatedRoute, movieService, authService, router, messageBus) {\n    this.activatedRoute = activatedRoute;\n    this.movieService = movieService;\n    this.authService = authService;\n    this.router = router;\n    this.messageBus = messageBus;\n    this.refreshMovieRequest$ = new BehaviorSubject(undefined);\n    this.isLoggedIn$ = this.authService.isLoggedIn$;\n    this.canLike = false;\n    this.isUserAuthor = false;\n    this.makeUpdate = false;\n  }\n  ngOnInit() {\n    combineLatest([this.activatedRoute.params.pipe(mergeMap(params => {\n      const movieId = params['movieId'];\n      return this.refreshMovieRequest$.pipe(mergeMap(() => this.movieService.loadMovieById(movieId)));\n    })), this.authService.currentUser$]).subscribe(([movie, user]) => {\n      this.currentUser = user;\n      this.movie = movie;\n      this.canLike = user && !this.movie.likes.includes(user === null || user === void 0 ? void 0 : user._id);\n      this.isUserAuthor = user && user.movies.includes(movie._id);\n    });\n  }\n  updateMovie() {\n    this.makeUpdate = true;\n  }\n  deleteMovieHandler() {\n    // console.log('try to delete')\n    if (window.confirm(`Are you sure you want to delete - ${this.movie.title} ?`)) {\n      this.messageBus.notifyForMessage({\n        text: `You delete movie - ${this.movie.title} !`,\n        type: MessageType.Success\n      });\n      this.movieService.deleteMovie(this.movie._id).subscribe(res => {\n        this.router.navigate(['/movies']);\n      });\n    }\n  }\n  likeMovie() {\n    // console.log('like movie');\n    this.movieService.likeMovie(this.movie._id).subscribe(() => this.refreshMovieRequest$.next(undefined));\n    this.messageBus.notifyForMessage({\n      text: 'You liked this movie!',\n      type: MessageType.Success\n    });\n  }\n  dislikeMovie() {\n    // console.log('dislike movie');\n    this.movieService.dislikeMovie(this.movie._id).subscribe(() => this.refreshMovieRequest$.next(undefined));\n    this.messageBus.notifyForMessage({\n      text: 'You disliked this movie!',\n      type: MessageType.Success\n    });\n  }\n}\nMoviesDetailPageComponent.ɵfac = function MoviesDetailPageComponent_Factory(t) {\n  return new (t || MoviesDetailPageComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.MovieService), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i4.MessageBusService));\n};\nMoviesDetailPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: MoviesDetailPageComponent,\n  selectors: [[\"app-movies-detail-page\"]],\n  decls: 2,\n  vars: 2,\n  consts: [[4, \"ngIf\"], [3, \"makeUpdate\", \"movieToUpdate\"], [\"class\", \"templatemo-detail content\", 4, \"ngIf\"], [1, \"templatemo-detail\", \"content\"], [1, \"about-detail\"], [1, \"right\", \"date\"], [1, \"fa\", \"fa-calendar\", \"icons\"], [\"alt\", \"\", 1, \"left\", \"shadow\", 3, \"src\"], [1, \"justify\"], [1, \"subtitle\"], [1, \"fa\", \"fa-solid\", \"fa-list\", \"fa-sm\", \"icons\"], [\"class\", \"checkmark pad-left\", 4, \"ngFor\", \"ngForOf\"], [1, \"buttons\"], [1, \"btnlike\"], [1, \"fa\", \"fa-thumbs-up\", \"fa-lg\", \"icons\"], [3, \"movieId\", \"movie\", 4, \"ngIf\"], [1, \"checkmark\", \"pad-left\"], [\"class\", \"hint\", 4, \"ngIf\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"btn\", \"btn-outline-primary\", 3, \"click\"], [1, \"btn\", \"btn-primary\", 3, \"disabled\", \"click\"], [1, \"btn\", \"btn-outline-primary\", 3, \"disabled\", \"click\"], [1, \"hint\"], [3, \"movieId\", \"movie\"]],\n  template: function MoviesDetailPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, MoviesDetailPageComponent_ng_container_0_Template, 2, 2, \"ng-container\", 0);\n      i0.ɵɵtemplate(1, MoviesDetailPageComponent_ng_container_1_Template, 2, 1, \"ng-container\", 0);\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.makeUpdate);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.makeUpdate);\n    }\n  },\n  dependencies: [i5.NgForOf, i5.NgIf, i6.MoviesNewPageComponent, i7.MoviesNewCommentComponent, i5.AsyncPipe, i5.DatePipe],\n  styles: [\"@import url(https://use.fontawesome.com/releases/v6.0.0/css/all.css);.templatemo-detail[_ngcontent-%COMP%]{\\r\\n    background-color: #EBF5FE;\\r\\n    \\r\\n    margin: auto;\\r\\n}\\r\\n\\r\\n.about-detail[_ngcontent-%COMP%]{\\r\\n    padding: 20px 40px;\\r\\n}\\r\\n\\r\\nh1[_ngcontent-%COMP%]{\\r\\n    color: #104C88;\\r\\n    font-weight: bold;\\r\\n}\\r\\n\\r\\n.justify[_ngcontent-%COMP%]{\\r\\n    padding-top: 20px;\\r\\n    height: auto;\\r\\n}\\r\\n\\r\\n.subtitle[_ngcontent-%COMP%]{\\r\\n    color: #104C88;\\r\\n}\\r\\n\\r\\n.right[_ngcontent-%COMP%]{\\r\\n    font-style: italic;\\r\\n}\\r\\n\\r\\nbutton[_ngcontent-%COMP%]{\\r\\n    margin: 0 5px;\\r\\n}\\r\\n\\r\\n.buttons[_ngcontent-%COMP%] {\\r\\n    display: -webkit-inline-box;\\r\\n}\\r\\n\\r\\n.btnlike[_ngcontent-%COMP%] {\\r\\n    padding-right: 12px;\\r\\n}\\r\\n\\r\\n.icons[_ngcontent-%COMP%] {\\r\\n    color: #0A335B ;\\r\\n}\\r\\n\\r\\n.hint[_ngcontent-%COMP%] {\\r\\n    margin: auto;\\r\\n    color: #4E749B;\\r\\n}\\n/*# sourceURL=webpack://./src/app/feature/movies/movies-detail-page/movies-detail-page.component.css */\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvZmVhdHVyZS9tb3ZpZXMvbW92aWVzLWRldGFpbC1wYWdlL21vdmllcy1kZXRhaWwtcGFnZS5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBO0lBQ0kseUJBQXlCO0lBQ3pCLGdCQUFnQjtJQUNoQixZQUFZO0FBQ2hCOztBQUVBO0lBQ0ksa0JBQWtCO0FBQ3RCOztBQUVBO0lBQ0ksY0FBYztJQUNkLGlCQUFpQjtBQUNyQjs7QUFFQTtJQUNJLGlCQUFpQjtJQUNqQixZQUFZO0FBQ2hCOztBQUVBO0lBQ0ksY0FBYztBQUNsQjs7QUFFQTtJQUNJLGtCQUFrQjtBQUN0Qjs7QUFFQTtJQUNJLGFBQWE7QUFDakI7O0FBRUE7SUFDSSwyQkFBMkI7QUFDL0I7O0FBRUE7SUFDSSxtQkFBbUI7QUFDdkI7O0FBRUE7SUFDSSxlQUFlO0FBQ25COztBQUVBO0lBQ0ksWUFBWTtJQUNaLGNBQWM7QUFDbEIiLCJzb3VyY2VzQ29udGVudCI6WyJAaW1wb3J0IHVybCgnaHR0cHM6Ly91c2UuZm9udGF3ZXNvbWUuY29tL3JlbGVhc2VzL3Y2LjAuMC9jc3MvYWxsLmNzcycpO1xyXG4udGVtcGxhdGVtby1kZXRhaWx7XHJcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRUJGNUZFO1xyXG4gICAgLyogd2lkdGg6IDgwJTsgKi9cclxuICAgIG1hcmdpbjogYXV0bztcclxufVxyXG5cclxuLmFib3V0LWRldGFpbHtcclxuICAgIHBhZGRpbmc6IDIwcHggNDBweDtcclxufVxyXG5cclxuaDF7XHJcbiAgICBjb2xvcjogIzEwNEM4ODtcclxuICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xyXG59XHJcblxyXG4uanVzdGlmeXtcclxuICAgIHBhZGRpbmctdG9wOiAyMHB4O1xyXG4gICAgaGVpZ2h0OiBhdXRvO1xyXG59XHJcblxyXG4uc3VidGl0bGV7XHJcbiAgICBjb2xvcjogIzEwNEM4ODtcclxufVxyXG5cclxuLnJpZ2h0e1xyXG4gICAgZm9udC1zdHlsZTogaXRhbGljO1xyXG59XHJcblxyXG5idXR0b257XHJcbiAgICBtYXJnaW46IDAgNXB4O1xyXG59XHJcblxyXG4uYnV0dG9ucyB7XHJcbiAgICBkaXNwbGF5OiAtd2Via2l0LWlubGluZS1ib3g7XHJcbn1cclxuXHJcbi5idG5saWtlIHtcclxuICAgIHBhZGRpbmctcmlnaHQ6IDEycHg7XHJcbn1cclxuXHJcbi5pY29ucyB7XHJcbiAgICBjb2xvcjogIzBBMzM1QiA7XHJcbn1cclxuXHJcbi5oaW50IHtcclxuICAgIG1hcmdpbjogYXV0bztcclxuICAgIGNvbG9yOiAjNEU3NDlCO1xyXG59Il0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["BehaviorSubject","combineLatest","mergeMap","MessageType","i0","MoviesDetailPageComponent","constructor","activatedRoute","movieService","authService","router","messageBus","undefined","isLoggedIn$","ngOnInit","params","pipe","movieId","refreshMovieRequest$","loadMovieById","currentUser$","subscribe","movie","user","currentUser","canLike","likes","includes","_id","isUserAuthor","movies","updateMovie","makeUpdate","deleteMovieHandler","window","confirm","title","notifyForMessage","text","type","Success","deleteMovie","res","navigate","likeMovie","next","dislikeMovie","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["D:\\Softuni\\softUni-Angular\\exam-project\\src\\app\\feature\\movies\\movies-detail-page\\movies-detail-page.component.ts","D:\\Softuni\\softUni-Angular\\exam-project\\src\\app\\feature\\movies\\movies-detail-page\\movies-detail-page.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { BehaviorSubject, combineLatest, Observable, map, mergeMap } from 'rxjs';\r\n// import {  map, mergeMap } from 'rxjs/operators';\r\nimport { AuthService } from 'src/app/auth.service';\r\nimport { IMovie, IUser } from 'src/app/core/interfaces';\r\nimport { MessageBusService, MessageType } from 'src/app/core/message-bus.service';\r\nimport { MovieService } from 'src/app/core/movie.service';\r\nimport { UserService } from 'src/app/core/user.service';\r\n\r\n\r\n@Component({\r\n  selector: 'app-movies-detail-page',\r\n  templateUrl: './movies-detail-page.component.html',\r\n  styleUrls: ['./movies-detail-page.component.css']\r\n})\r\nexport class MoviesDetailPageComponent implements OnInit {\r\n\r\n  refreshMovieRequest$ = new BehaviorSubject(undefined);\r\n  movie: IMovie;\r\n  currentUser?: IUser;\r\n\r\n  isLoggedIn$: Observable<boolean> = this.authService.isLoggedIn$;\r\n  canLike: boolean = false;\r\n  isUserAuthor: boolean = false;\r\n\r\n  makeUpdate: boolean = false;\r\n\r\n  constructor(private activatedRoute: ActivatedRoute,\r\n    private movieService: MovieService,\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private messageBus: MessageBusService\r\n  ) { }\r\n\r\n  ngOnInit(): void {\r\n    combineLatest([\r\n      this.activatedRoute.params\r\n        .pipe(\r\n          mergeMap(params => {\r\n            const movieId = params['movieId'];\r\n            return this.refreshMovieRequest$.pipe(mergeMap(() => this.movieService.loadMovieById(movieId)));\r\n          })\r\n        ),\r\n      this.authService.currentUser$\r\n    ])\r\n      .subscribe(([movie, user]) => {\r\n      \r\n        this.currentUser = user;\r\n        this.movie = movie;\r\n        this.canLike = user && !this.movie.likes.includes(user?._id);\r\n      \r\n        this.isUserAuthor = user && user.movies.includes(movie._id);\r\n      })\r\n\r\n  }\r\n\r\n  updateMovie() {\r\n    this.makeUpdate = true;\r\n  }\r\n\r\n\r\n  deleteMovieHandler() {\r\n    // console.log('try to delete')\r\n    if (window.confirm(`Are you sure you want to delete - ${this.movie.title} ?`)) {\r\n\r\n      this.messageBus.notifyForMessage({\r\n        text: `You delete movie - ${this.movie.title} !`,\r\n        type: MessageType.Success\r\n      })\r\n\r\n      this.movieService.deleteMovie(this.movie._id)\r\n        .subscribe((res: any) => {\r\n          this.router.navigate(['/movies']);\r\n        })\r\n    }\r\n  }\r\n\r\n  likeMovie() {\r\n    // console.log('like movie');\r\n\r\n    this.movieService.likeMovie(this.movie._id)\r\n      .subscribe(() => this.refreshMovieRequest$.next(undefined));\r\n\r\n    this.messageBus.notifyForMessage({\r\n      text: 'You liked this movie!',\r\n      type: MessageType.Success\r\n    })\r\n  }\r\n\r\n  dislikeMovie() {\r\n    // console.log('dislike movie');\r\n\r\n    this.movieService.dislikeMovie(this.movie._id)\r\n      .subscribe(() => this.refreshMovieRequest$.next(undefined));\r\n\r\n    this.messageBus.notifyForMessage({\r\n      text: 'You disliked this movie!',\r\n      type: MessageType.Success\r\n    })\r\n  }\r\n}","<ng-container *ngIf=\"makeUpdate\">\r\n    <app-movies-new-page [makeUpdate]=\"makeUpdate\" [movieToUpdate]=\"movie\"></app-movies-new-page>\r\n</ng-container>\r\n\r\n<ng-container *ngIf=\"!makeUpdate\">\r\n    <div class=\"templatemo-detail content\" *ngIf=\"movie\">\r\n\r\n        <div class=\"about-detail\">\r\n            <h1>{{movie.title}}</h1>\r\n            <p class=\"right date\"><i class=\"fa fa-calendar icons\"></i> date: {{movie.created_at | date:'medium'}}</p>\r\n            <br>\r\n\r\n            <img src=\"{{movie.poster}}\" alt=\"\" class=\"left shadow\">\r\n            <p class=\"justify\">{{movie.shortStory}}</p> \r\n\r\n            <h2 class=\"subtitle\">\r\n                <i class=\"fa fa-solid fa-list fa-sm icons\"></i>\r\n                Actors:\r\n            </h2>\r\n            <ul class=\"checkmark pad-left\" *ngFor=\"let actor of movie.actors\">\r\n                <li>{{actor}}</li>\r\n            </ul>\r\n\r\n            <div class=\"buttons\">\r\n                <div class=\"btnlike\">\r\n                    <i class=\"fa fa-thumbs-up fa-lg icons\">Likes: </i>{{movie.likes.length}}\r\n                </div>\r\n                <ng-container *ngIf=\"(isLoggedIn$ | async)\">\r\n                    <div *ngIf=\"isUserAuthor\">\r\n                        <button (click)=\"updateMovie()\" class=\"btn btn-primary\">Edit</button>\r\n                        <button (click)=\"deleteMovieHandler()\" class=\"btn btn-outline-primary\">Delete</button>\r\n                    </div>\r\n                    <div *ngIf=\"!isUserAuthor\">\r\n                        <button [disabled]=\"canLike\" (click)=\"likeMovie()\" class=\"btn btn-primary\">Like</button>\r\n                        <button [disabled]=\"!canLike\" (click)=\"dislikeMovie()\"\r\n                            class=\"btn btn-outline-primary\">Dislike</button>\r\n                    </div>\r\n                    <div *ngIf=\"!canLike\" class=\"hint\">\r\n                        You already liked it! But you can dislike it.\r\n                    </div>\r\n                </ng-container>\r\n            </div>\r\n        </div>\r\n        <app-movies-new-comment *ngIf=\"!isUserAuthor\" [movieId]=\"movie._id\" [movie]=\"movie\"></app-movies-new-comment>\r\n    </div>\r\n\r\n   \r\n</ng-container>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}